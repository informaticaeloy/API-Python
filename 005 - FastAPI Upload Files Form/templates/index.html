{% extends 'base.html' %}
 
{% block content %}
    <div class="panel panel-default" style="margin-top: 50px;">
        <div class="panel-heading"><b>Envío de ficheros para su analisis</b></div>
        <div class="panel-body">
            <form id="uploadImage" method="post" action="/uploadfile" enctype="multipart/form-data">
                <div class="form-group" id="div_del_correo" >
                    <div class="form-group required">
                        <label >Correo electrónico</label>
                        <input type="text" class="form-control text-lowercase" id="mail_address" required="" name="mail_address" value="">
                    </div>       
                </div>
                <div class="form-group" id="div_del_fichero">
                    <label>Fichero a enviar</label>
                    <input type="file" name="file" multiple="true" id="file" />
                </div>
                <div class="form-group" id="div_del_boton" >
                    <input type="submit" id="uploadSubmit" value="Enviar" class="btn btn-info" />
                </div>
                <div class="progress" id="div_de_la_barra">
                    <div class="progress-bar progress-bar-striped bg-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <div id="loading" style="display:none;" class="form-group">
                    <img src="../static/images/uploading.gif" alt="" width="150px">
                    <label>Enviando fichero...</label>
                </div>
                <div id="targetLayer" style="display:none;"></div>
            </form>
        </div>
    </div>
<script>
$(document).ready(function(){
$('#uploadImage').submit(function(event){
    if($('#file').val()){
        event.preventDefault();
        $('#targetLayer').hide();
        $('#loading').show();
        $(this).ajaxSubmit({
            target: '#targetLayer',
            beforeSubmit:function(){
                $('.progress-bar').width('50%');
            },
            uploadProgress: function(event, position, total, percentageComplete)
            {
                $('.progress-bar').animate({
                    width: percentageComplete + '%'
                }, {
                    duration: 1000
                });
            },
            success:function(data){ //alert(data);
                $('#loading').hide();
                $('#div_del_correo').hide();
                $('#div_del_fichero').hide();
                $('#div_del_boton').hide();
                $('#div_de_la_barra').hide();
                $('#targetLayer').show();
                $('#targetLayer').append(data.htmlresponse);
            },
            resetForm: true
        });
    }
    return false;
});
});
</script>
{% endblock content %}